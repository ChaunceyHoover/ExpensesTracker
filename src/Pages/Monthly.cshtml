@page
@model MonthlyModel
@{
    // .ToString("C") returns parentheses for negative money (ex: "($1.23)") instead of using a negative sign (ex: "-$1.23"),
    // so we're going to manually format negative numbers to make it show how we want for negative numbers
    Func<float, string> FormatCurrency = (currency) =>
        currency >= 0 ?
    currency.ToString("C") :                // Positive numbers are fine - return as is (ex: $1.23)
    $"-{Math.Abs(currency).ToString("C")}"; // Prepend "-" in front of the absolute value for negatives to get the right format (ex: -$1.23)

    var startOfMonth = new DateOnly(DateTime.Now.Year, DateTime.Now.Month, 1);
    var endOfMonth = startOfMonth.AddMonths(1).AddDays(-1);
}

@section Headers {
<link rel="stylesheet" href="~/lib/jquery-datatables/dist/css/dataTables.bootstrap5.min.css" />
}

<div class="text-center">
    <h1 class="display-4 mb-5">Monthly Bills</h1>

    <div class="d-flex flex-1 mb-3">
        <div class="input-group w-75 mx-auto">
            <span class="input-group-text">Date Range</span>
            <input id="start-date" type="date" aria-label="Start Date" value="@startOfMonth.ToString("yyyy-MM-dd")" class="form-control" />
            <input id="end-date" type="date" aria-label="End Date" value="@endOfMonth.ToString("yyyy-MM-dd")" class="form-control" />
        </div>
    </div>

    <div class="accordion" id="expensesAccordion">
        <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#dynamicPanel">
                    Split Expenses
                </button>
            </h2>
            <div id="dynamicPanel" class="accordion-collapse collapse show" data-bs-parent="#expensesAccordion">
                <div class="d-flex justify-content-end my-3">
                    <button id="btn-add-purchase" class="btn btn-primary me-2" data-bs-toggle="modal" data-bs-target="#dynamicModal">Add Purchase</button>
                    <button id="btn-remove-purchase" class="btn btn-danger me-5" disabled>Remove Purchase</button>
                </div>
                <div class="accordion-body">
                    <table id="dynamic" class="flex-1 table">
                        <thead>
                            <tr>
                                <th>Payee</th>
                                <th>Vendor</th>
                                <th>Date</th>
                                <th>Amount</th>
                                <th>Split</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#loansPanel">
                    Loans
                </button>
            </h2>
            <div id="loansPanel" class="accordion-collapse collapse" data-bs-parent="#expensesAccordion">
                <div class="d-flex justify-content-end my-3">
                    <button id="btn-add-loan" class="btn btn-primary me-2" data-bs-toggle="modal" data-bs-target="#dynamicModal">Add Loan</button>
                    <button id="btn-remove-loan" class="btn btn-danger me-5" disabled>Remove Loan</button>
                </div>
                <div class="accordion-body">
                    <table id="loans" class="flex-1 table">
                        <thead>
                            <tr>
                                <th>Lender</th>
                                <th>Vendor</th>
                                <th>Date</th>
                                <th>Amount</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#staticPanel">
                    Reoccurring Expenses
                </button>
            </h2>
            <div id="staticPanel" class="accordion-collapse collapse" data-bs-parent="#expensesAccordion">
                <div class="d-flex justify-content-end my-3">
                    <button id="btn-add-expense" class="btn btn-primary me-2">Add Expense</button>
                    <button id="btn-remove-expense" class="btn btn-danger me-5" disabled>Remove Expense</button>
                </div>
                <div class="accordion-body">
                    <table id="static" class="flex-1 table">
                        <thead>
                            <tr>
                                <th>Bill</th>
                                <th>Issued</th>
                                <th>Amount</th>
                                <th>Split</th>
                                <th>Notes</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

@section Modals {
    <div class="modal fade" id="dynamicModal" tabindex="-1" aria-labelledby="dynamicModalTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="dynamic-modal-title">Add Expense</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="d-flex justify-content-around">
                        <div class="flex-fill me-2">
                            <label for="dynamic-payee-select" class="form-label">Payee</label>
                            <select id="dynamic-payee-select" class="form-select" aria-label="Default select example" disabled>
                                <option value="-1" selected>Select payee...</option>
                            </select>
                        </div>
                        <div class="flex-fill ms-2">
                            <label for="dynamic-vendor-select" class="form-label">Vendor</label>
                            <select id="dynamic-vendor-select" class="form-select" aria-label="Default select example" disabled>
                                <option value="-1" selected>Select vendor...</option>
                            </select>
                        </div>
                    </div>
                    <div class="d-flex justify-content-around mt-3">
                        <div class="flex-fill me-2">
                            <label for="dynamic-date" class="form-label">Purchase Date</label>
                            <input type="date" class="form-control" id="dynamic-date" />
                        </div>
                        <div class="flex-fill ms-2">
                            <label for="dynamic-amount" class="form-label">Amount</label>
                            <input type="number" class="form-control" id="dynamic-amount" />
                        </div>
                    </div>
                    <div class="mt-3">
                        <div class="flex-fill">
                            <label for="dynamic-notes" class="form-label">Notes <span style="font-size:0.75rem;opacity:0.75">(Optional)</span></label>
                            <textarea class="form-control" id="dynamic-notes" rows="3"></textarea>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button id="btn-add-dynamic-expense" type="button" class="btn btn-primary">Add</button>
                </div>
            </div>
        </div>
    </div>
}

@section Scripts {
<script src="~/lib/jquery-datatables/dist/js/jquery.dataTables.min.js"></script>
<script src="~/lib/jquery-datatables/dist/js/dataTables.bootstrap5.min.js"></script>
<script src="~/js/monthly.js" asp-append-version="true"></script>
}